<div class="page-wrapper">
  <app-header></app-header>

  <div class="container page-content">
    <div class="mx-auto col-8">
      <div class="mb-4">
        <div class="mb-2 d-flex align-items-center">
          <i class="bi bi-stars fs-4 me-2"></i>
          <h3 class="m-0 fw-bold">{{this.formsData.formTitle}}</h3>
        </div>
        <div class="survey-clean-card shadow-sm p-4 px-md-5 rounded-4 bg-white">
          <div class="d-flex flex-wrap gap-2 mb-3">
            <span class="badge bg-light text-dark border p-2 px-3 rounded-pill">
              <i class="bi bi-calendar-check me-1"></i> {{this.formsData.formSDate}} ~ {{this.formsData.formEDate}}
            </span>
            <span class="badge bg-light text-dark border p-2 px-3 rounded-pill">
              <i class="bi bi-clock me-1"></i> 預計 3 分鐘
            </span>
          </div>
          <div class="description-box p-3 rounded-3">
            <p class="mb-0">{{this.formsData.formDescription}}</p>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <div class="mb-2 d-flex align-items-center">
          <i class="bi bi-person-badge fs-4 me-2"></i>
          <h4 class="m-0 fw-bold">基本資料</h4>
        </div>
        <div class="survey-clean-card shadow-sm p-4 px-md-5 rounded-4 bg-white">
          <div class="row">
            <div class="col-12 mb-3">
              <label class="form-label fw-bold small" for="name">姓名 <span class="text-danger">*</span></label>
              <span class="error-text"
                [ngClass]="{'is-visible': isEmpty(userInfo.name) && (!isEmpty(userInfo.name) || showAll)}">
                請輸入姓名
              </span>
              <input type="text" class="form-control custom-input" placeholder="請填寫姓名" name="name" id="name"
                [(ngModel)]="userInfo.name"
                [ngClass]="{ 'is-invalid': isEmpty(userInfo.name) && (!isEmpty(userInfo.name) || showAll)}">
            </div>

            <div class="col-12 mb-3">
              <label class="form-label fw-bold small" for="age">年齡</label>
              <input type="number" class="form-control custom-input" placeholder="請輸入年齡" min="0" name="age" id="age"
                [(ngModel)]="userInfo.age">
            </div>

            <div class="col-12 mb-3">
              <label class="form-label fw-bold small" for="tel">手機 <span class="text-danger">*</span></label>
              <span class="error-text"
                [ngClass]="{'is-visible': isTelInvalid(userInfo.tel) && (!isEmpty(userInfo.tel) || showAll)}">
                請輸入正確的手機格式
              </span>
              <input type="tel" class="form-control custom-input" placeholder="0912-345-678" name="tel" id="tel"
                [(ngModel)]="userInfo.tel"
                [ngClass]="{ 'is-invalid': isTelInvalid(userInfo.tel) && (!isEmpty(userInfo.tel) || showAll)}">
            </div>

            <div class="col-12 mb-3">
              <label class="form-label fw-bold small" for="email">Email <span class="text-danger">*</span></label>
              <span class="error-text"
                [ngClass]="{'is-visible': isEmailInvalid(userInfo.email) && (!isEmpty(userInfo.email) || showAll)}">
                Email 格式有誤
              </span>
              <input type="email" class="form-control custom-input" placeholder="example@mail.com" name="email"
                id="email" [(ngModel)]="userInfo.email"
                [ngClass]="{ 'is-invalid': isEmailInvalid(userInfo.email) && (!isEmpty(userInfo.email) || showAll)}">
            </div>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <div class="mb-2 d-flex align-items-center">
          <i class="bi bi-pencil-square fs-4 me-2"></i>
          <h4 class="m-0 fw-bold">問卷內容</h4>
        </div>
        <div class="survey-clean-card shadow-sm p-4 px-md-5 rounded-4 bg-white">
          @for (item of this.formsData.formFields; track $index) {
          <div class="question-item mb-4 mb-3">
            <h6 class="fw-bold mb-3">
              {{item.questionID}}. {{item.questionDescription}}
              @if(item.questionRequired){ <span class="text-danger"> *</span> }
              <span class="error-text ms-2"
                [ngClass]="{'is-visible': item.questionRequired && isEmpty(answers[item.questionID]) && showAll}">
                此題必填
              </span>
            </h6>

            @if(item.questionType == 'single-choice'){
            <div class="ps-2 d-flex flex-column gap-2">
              @for (option of item.questionOptions; track $index) {
              <div class="form-check custom-check">
                <input class="form-check-input" type="radio" name="{{`${item.questionID}`}}"
                  id="{{`${item.questionID}_opt${$index}`}}" [value]="option" [(ngModel)]="answers[item.questionID]">
                <label class="form-check-label" for="{{`${item.questionID}_opt${$index}`}}">{{ option }}</label>
              </div>
              }
            </div>
            }

            @if(item.questionType == 'multiple-choice' ){
            <div class="ps-2 d-flex flex-column gap-2">
              @for (option of item.questionOptions; track $index) {
              <div class="form-check custom-check">
                <input class="form-check-input" type="checkbox" name="{{`${item.questionID}`}}"
                  id="{{`${item.questionID}_opt${$index}`}}" [value]="option"
                  [checked]="answers[item.questionID]?.includes(option)"
                  (change)="onCheckboxChange(item.questionID, option)">
                <label class="form-check-label" for="{{`${item.questionID}_opt${$index}`}}">{{ option }}</label>
              </div>
              }
            </div>
            }

            @if (item.questionType=='text') {
            <input type="text" class="form-control custom-input" placeholder="{{item.questionHolder}}"
              name="{{`${item.questionID}`}}" [(ngModel)]="answers[item.questionID]"
              [ngClass]="{ 'is-invalid': item.questionRequired && isEmpty(answers[item.questionID]) && (!isEmpty(answers[item.questionID]) || showAll)}">
            }
          </div>
          }

          <div class="text-center mt-5">
            <button type="button" class="btn btn-outline-secondary rounded-pill px-5 me-2 fw-bold border-2"
              (click)="onCancel()">
              取消填寫
            </button>
            <button type="button" class="btn btn-orange-filled rounded-pill px-5 fw-bold border-1"
              (click)="goComfirm()">
              下一步：確認內容
            </button>
          </div>
        </div>
      </div>

      <app-footer></app-footer>
    </div>
  </div>
</div>